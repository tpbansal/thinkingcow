<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <title>{% if page.url == "/" %}{{ site.title }} | {{ page.title }}{% elsif page.title %}{{ page.title }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
    <meta name="description"
        content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    <meta name="keywords" content="{{ page.keywords | default: site.keywords }}">
    <meta name="author" content="{{ site.author.name }}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.url | absolute_url }}">

    <!-- Open Graph -->
    <meta property="og:title" content="{% if page.url == "/" %}{{ site.title }} | {{ page.title }}{% elsif page.title %}{{ page.title }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}">
    <meta property="og:description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:image" content="{{ site.url }}/docs/images/cow1.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% if page.url == "/" %}{{ site.title }} | {{ page.title }}{% elsif page.title %}{{ page.title }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}">
    <meta name="twitter:description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    <meta name="twitter:image" content="{{ site.url }}/docs/images/cow1.jpg">

    <!-- SEO tags -->
    {% seo %}

    <!-- Structured Data - Website/Blog -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{% if page.layout == 'post' %}BlogPosting{% else %}WebSite{% endif %}",
        "name": "{{ site.title }}",
        "description": "{{ site.description }}",
        "url": "{{ site.url }}",
        {% if page.layout == 'post' %}
        "headline": "{{ page.title }}",
        "datePublished": "{{ page.date | date_to_xmlschema }}",
        {% endif %}
        "author": {
            "@type": "Person",
            "name": "{{ site.author.name }}",
            "url": "{{ site.author.url }}",
            "email": "{{ site.author.email }}",
            "sameAs": [
                "{{ site.social.github }}",
                "{{ site.social.linkedin }}"
            ]
        },
        "publisher": {
            "@type": "Organization",
            "name": "{{ site.title }}",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ site.url }}/docs/images/cow1.jpg"
            }
        }
    }
    </script>

    <!-- Structured Data - Person (for name searches: Tapasvi Bansal, Tapasvi) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "{{ site.author.name }}",
        "alternateName": "{{ site.author.alias }}",
        "url": "{{ site.url }}",
        "email": "{{ site.author.email }}",
        "jobTitle": "Security Researcher & Software Engineer",
        "description": "{{ site.description }}",
        "knowsAbout": [
            "Security Research",
            "Software Engineering",
            "Cloud Security",
            "Product Security",
            "Privacy Tools",
            "Web Development",
            "Browser Fingerprinting",
            "Digital Privacy",
            "Cybersecurity"
        ],
        "sameAs": [
            "{{ site.social.github }}",
            "{{ site.social.linkedin }}",
            "https://twitter.com/{{ site.twitter.username }}"
        ],
        "alumniOf": {
            "@type": "Organization",
            "name": "Electronic Systems & Software Engineering"
        },
        "mainEntityOfPage": "{{ site.author.url }}"
    }
    </script>

    <!-- Styles -->
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ site.favicon | relative_url }}">

    <!-- Circuit Background Animation -->
    <script src="{{ '/assets/js/circuit-background.js' | relative_url }}" defer></script>
</head>

<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>

    <div class="container">
        <header role="banner">
            <div class="header-content">
                <div class="header-logo">
                    <img src="{{ site.logo | relative_url }}" alt="{{ site.title }} logo" class="site-logo">
                </div>
                <div class="header-text">
                    <h1><a href="{{ '/' | relative_url }}" class="site-title-link" aria-label="Home - {{ site.title }}">{{ site.title }}</a></h1>
                    <p>{{ site.description }}</p>
                </div>
            </div>
        </header>

        <nav role="navigation" aria-label="Main navigation">
            {% for item in site.navigation %}
            {% assign current = false %}
            {% if page.url == item.url %}
            {% assign current = true %}
            {% elsif page.url contains '/posts/' and item.url == '/posts/' %}
            {% assign current = true %}
            {% endif %}
            <a href="{{ item.url | relative_url }}" {% if current %} class="current" aria-current="page" {% endif %}>{{ item.title }}</a>
            {% endfor %}
        </nav>

        <main id="main-content" class="content" role="main">
            {{ content }}
        </main>

        <footer role="contentinfo">
            <p>&copy; {{ site.time | date: "%Y" }} {{ site.title }}. All Rights Reserved. MIT License. </p>
        </footer>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookie-consent" class="cookie-consent cookie-consent-hidden" role="dialog" aria-labelledby="cookie-consent-title" aria-describedby="cookie-consent-desc">
        <div class="cookie-consent-content">
            <p id="cookie-consent-desc">We use cookies to analyze site traffic and improve your experience. Your data is anonymized.</p>
            <div class="cookie-consent-buttons">
                <button id="cookie-accept" class="cookie-btn cookie-accept" aria-label="Accept cookies and enable analytics">Accept</button>
                <button id="cookie-decline" class="cookie-btn cookie-decline" aria-label="Decline cookies and disable analytics">Decline</button>
            </div>
        </div>
    </div>

    <!-- Google tag (gtag.js) - Only loads after consent -->
    <script>
        // Cookie consent management
        (function() {
            const CONSENT_COOKIE = 'cookie_consent';
            const CONSENT_EXPIRY_DAYS = 365;

            // Get cookie value
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            }

            // Set cookie
            function setCookie(name, value, days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = `expires=${date.toUTCString()}`;
                document.cookie = `${name}=${value};${expires};path=/;SameSite=Lax`;
            }

            // Initialize Google Analytics
            function initGoogleAnalytics() {
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                window.gtag = gtag;
                gtag('js', new Date());
                gtag('config', 'G-GV4X074578', {
                    'anonymize_ip': true,
                    'cookie_flags': 'SameSite=Lax;Secure',
                    'cookie_expires': 63072000  // 2 years in seconds
                });

                // Load gtag.js script
                const script = document.createElement('script');
                script.async = true;
                script.src = 'https://www.googletagmanager.com/gtag/js?id=G-GV4X074578';
                document.head.appendChild(script);
            }

            // Show cookie banner
            function showBanner() {
                const banner = document.getElementById('cookie-consent');
                if (banner) {
                    banner.classList.remove('cookie-consent-hidden');
                    // Focus on the accept button for keyboard users
                    setTimeout(() => {
                        const acceptBtn = document.getElementById('cookie-accept');
                        if (acceptBtn) acceptBtn.focus();
                    }, 100);
                }
            }

            // Hide cookie banner
            function hideBanner() {
                const banner = document.getElementById('cookie-consent');
                if (banner) banner.classList.add('cookie-consent-hidden');
            }

            // Handle consent
            function handleConsent(accepted) {
                setCookie(CONSENT_COOKIE, accepted ? 'accepted' : 'declined', CONSENT_EXPIRY_DAYS);
                hideBanner();
                if (accepted) {
                    initGoogleAnalytics();
                }
            }

            // Check existing consent on page load
            const consent = getCookie(CONSENT_COOKIE);
            if (consent === 'accepted') {
                initGoogleAnalytics();
            } else if (consent === 'declined') {
                // Do nothing - user declined
            } else {
                // No consent yet - show banner
                showBanner();
            }

            // Attach event listeners
            document.addEventListener('DOMContentLoaded', function() {
                const acceptBtn = document.getElementById('cookie-accept');
                const declineBtn = document.getElementById('cookie-decline');
                const banner = document.getElementById('cookie-consent');

                if (acceptBtn) {
                    acceptBtn.addEventListener('click', function() {
                        handleConsent(true);
                    });
                }

                if (declineBtn) {
                    declineBtn.addEventListener('click', function() {
                        handleConsent(false);
                    });
                }

                // Allow Escape key to decline cookies
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && banner && !banner.classList.contains('cookie-consent-hidden')) {
                        handleConsent(false);
                    }
                });
            });
        })();
    </script>
</body>

</html>